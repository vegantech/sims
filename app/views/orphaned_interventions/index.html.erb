<h1>Orphaned Interventions</h1>


<%form_tag do %>
<table>
  <thead>
    <tr>
      <th>End</th>
      <th>Student</th>
      <th>Intervention</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Participants</th>
  </tr>

  </thead>
  <tbody>
    <%@interventions.each do |intervention| %>
      <tr>
        <td><%= check_box_tag 'id[]',intervention.id, false, :id => "ck_#{intervention.id}" %></td>
        <td><%=intervention.student %> </td>
        <td><%=intervention.title %></td>
        <td><%=intervention.start_date %> </td>
        <td <%= "style='color: red;'"  if intervention.end_date < Date.today%> >
          <%= unobtrusive_date_picker_tags intervention.end_date, 
            {:order => [:month, :day, :year], :start_year => (1.year.ago).year, :end_year => 2.years.since().year, 
              :prefix => "end_date#{intervention.id}"},
              {:onchange => remote_function(:url =>  update_end_date_orphaned_intervention_path(intervention), 
                                            :with => "'month=' + $('end_date#{intervention.id}-mm').value + '&day=' + $('end_date#{intervention.id}-dd').value +'&year=' + $('end_date#{intervention.id}').value",
                        :method => 'put')}
           %>
          *</td>
        <td><%=render :partial => "participant_list", :locals=>{:intervention => intervention} %></td>
      </tr>
    <% end %>

  </tbody>
</table>
<br />
<br />

<div id="end_intervention_reasons">
  <p> Please choose a reason for ending the selected interventions. </p>
  <%Intervention::END_REASONS.each do |end_reason| %>
    <%= radio_button_tag('end_reason', end_reason,{}, {:onclick=> "$('end_submit_tag').disabled=false;"}) %>
    <label for="end_reason_<%=end_reason.underscore.gsub(" ","_")%>"><%=end_reason %></label><br />
  <% end %>
  <%= submit_tag 'End Selected', :confirm=>"Are you sure you want to end these intervention?" ,:disabled=>true, :id => 'end_submit_tag'%>
  </div>
<% end %>

<br />
<p>An orphaned intervention is an 
intervention that has not yet been ended <br />
that has also gone past the end date,  <br />
has one or more participants that cannot access the student,  <br />
or has no participants at all. </p>

<p>The red fields show why that intervention is considered orphaned.</p>

<p>To end one or more interventions, check the boxes at the left, and then press the "End Selected" Button.  (You may also need to pick a reason.) </p>
<p>You can add participants by selecting them from the dropdown in each intervention row.  The X next to a participant will remove him/her. </p>
<p>You can change the end date by clicking on the icon next to the date and then choosing a new one. </p>


